---
title: "PA1_template.Rmd"
author: "xmyyj001"
date: "2018年5月1日"
output: html_document
---
## Introduction
This course is about processing a large amount of data about personal movement using activity monitoring devices. The data is download from [activity monitoring data](https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip/) .

## Requerements
In this course project, I have done such processing steps:
1.Code for reading in the dataset and/or processing the data
2.Histogram of the total number of steps taken each day
3.Mean and median number of steps taken each day
4.Time series plot of the average number of steps taken
5.The 5-minute interval that, on average, contains the maximum number of steps
6.Code to describe and show a strategy for imputing missing data
7.Histogram of the total number of steps taken each day after missing values are imputed
8.Panel plot comparing the average number of steps taken per 5-minute interval across weekdays and weekends
9.All of the R code needed to reproduce the results (numbers, plots, etc.) in the report.

## Loading and preprocessing the data
Process the data into a format suitable for the analysis,Code for reading in the dataset and processing the data as below:

```{r reading_data,echo=TRUE}
if(!file.exists("activity.csv")){
  down_url<-"https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
  download.file(down_url,destfile = "./repdata_data_activity.zip")
  unzip("repdata_data_activity.zip")
}

aci_data<-read.csv("./activity.csv")
aci_data<-as.data.frame(aci_data)

library(dplyr)
```
##Histogram of the total number of steps taken each day
```{r hist_total}
by_da<-aci_data%>%group_by(date)%>%summarize(sum_step=sum(steps,na.rm=T))
hist(by_da$sum_step)
```

## calculate mean and median number of steps taken each day
Calculate the total number of steps taken per day,then calculate and report the mean and median of the total number of steps taken per day.
Mean number of steps  taken per day:
```{r calcu_mean}
mean(by_da$sum_step,na.rm = T)
```
Median number of steps taken per day:
```{r calcu_median}
median(by_da$sum_step,na.rm = T)
```

## Time series plot of the average number of steps taken
```{r plot_TS_average}
# define a function for computing interval data frame
for_cal_data<-filter(aci_data,!is.na(aci_data$steps))
mean_na_steps<-tapply(for_cal_data$steps,for_cal_data$interval,mean)
mean_na_steps<-cbind(as.data.frame(unique(for_cal_data$interval)),as.data.frame(round(mean_na_steps,0)))
names(mean_na_steps)<-c("interval","mean_steps")
with(mean_na_steps,plot(interval,mean_steps,type="l",main="average number of steps taken per day"))

```

## The 5-minute interval that, on average, contains the maximum number of steps
5-minute interval, on average across all the days in the dataset, contains the maximum number of steps, which is:
```{r 5-min_max_steps}
mean_na_steps[which.max(mean_na_steps[,2]),]

```

## Code to describe and show a strategy for imputing missing data

Below strategy to replace NA with the mean number of the according interval. The whole data is 
instored in rev_aci_data.

```{r imputing_missing}
imputing_miss_value<-function(input_data=aci_data){
  rev_aci_data<-aci_data
  na_da<-rev_aci_data[is.na(rev_aci_data$steps),]
  #mean value to replace the missing value
  na_dat<-as.character(unique(na_da$date))
  tem<-length(na_dat)

  for(j in 1:tem){
    rev_aci_data[rev_aci_data$date==na_dat[j],]<-rev_aci_data[rev_aci_data$date==na_dat[j],]%>% mutate(steps=mean_na_steps[,2])
  }
  return(rev_aci_data)
}

rev_aci_data<-imputing_miss_value()
```

## Histogram of the total number of steps taken each day after missing values are imputed
```{r plot_whole_data}

by_da<-rev_aci_data%>%group_by(date)%>%summarize(sum_step=sum(steps,na.rm=T))
hist(by_da$sum_step)
```

##Panel plot comparing intervals across weekdays and weekends
After replace the missing value, below code compare the average number of steps taken per 5-minute intervals across weekdays and weekends.

```{r plot_weekds_vs_weekends}

is_weekd<-filter(rev_aci_data,weekdays(as.Date(rev_aci_data$date,format= "%Y-%m-%d"))!="星期六"&
                        weekdays(as.Date(rev_aci_data$date,format= "%Y-%m-%d"))!="星期日")
not_weekd<-filter(rev_aci_data,weekdays(as.Date(rev_aci_data$date,format= "%Y-%m-%d"))=="星期六"|
                        weekdays(as.Date(rev_aci_data$date,format= "%Y-%m-%d"))=="星期日")

mean_steps<-tapply(rev_aci_data$steps,rev_aci_data$interval,mean)
mean_weekdays<-tapply(is_weekd$steps,is_weekd$interval,mean)
mean_weekends<-tapply(not_weekd$steps,not_weekd$interval,mean)
mean_acro_week<-cbind(as.data.frame(unique(aci_data$interval)),as.data.frame(round(mean_steps,0)),
                      as.data.frame(round(mean_weekdays,0)),as.data.frame(round(mean_weekends,0)))
names(mean_acro_week)<-c("interval","mean_steps","mean_weekdays","mean_weekends")
par(mar=c(4,4,2,2),mfrow=c(2,1))
with(mean_acro_week,{plot(interval,mean_weekdays-mean_steps,type="l",main="week days steps",ylim = c(-80,80)) +plot(interval,mean_weekends-mean_steps,type = "l",main="weekends steps",ylim = c(-80,80))})


```

